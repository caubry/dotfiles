#!/usr/bin/env bash

export DOTFILES=~/.dotfiles
shopt -s dotglob

REPO_URL=https://github.com/jamesmcfadden/dotfiles
FORCE=false

while getopts ":f" opt; do
  case $opt in
    f)
      echo "Forcing..."
      FORCE=true
      ;;
    \?)
      echo "Invalid option: -$OPTARG" >&2
      exit 1
      ;;
  esac
done

if [[ ! -d $DOTFILES ]]
then
  echo "[INSTALL] $REPO_URL"
  git clone $REPO_URL $DOTFILES
else
  echo "[UPDATE] $DOTFILES"
  cd $DOTFILES
  git pull
fi

for f in $DOTFILES/link/*
do
  dest=~/${f##*/}
  if [[ -e $dest && $FORCE = false ]]
  then
    echo "! $dest already exists, not symlinking"
  else
    echo "[LINK] $f --> $dest"
    ln -sf $f $dest
  fi
done

for f in $DOTFILES/copy/*
do
  dest=~/${f##*/}
  if [[ -e $dest && $FORCE = false ]]
  then
    echo "! $dest already exists, not copying"
  else
    echo "[COPY] $f --> $dest"
    cp $f $dest
  fi
done

echo "Finished"
